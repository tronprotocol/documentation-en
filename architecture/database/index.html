<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Database - TRON Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Database";
    var mkdocs_page_input_path = "architecture/database.md";
    var mkdocs_page_url = "/documentation-en/architecture/database/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> TRON Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/">Repository</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/dpos/">DPoS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/overview/">Overview</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/http/">HTTP API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/rpc/">RPC API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanism & Algorithm</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/sr/">SR and Committee</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/trc10/">TRC-10</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/account/">Account Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/resource/">Resource Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/dex/">Decentralized Exchange</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/multi-signatures/">Multi-Signature</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/shielded-transaction/">Shielded Transaction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/system-contracts/">System Contracts</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../network/">Network</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Database</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#the-database">The Database</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#use-rocksdb">Use RocksDB</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../event/">Event Subsystem</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Smart Contract</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contracts/tvm/">TVM</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/compiler/">Compiler</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/contract/">Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/trc20/">TRC-20</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../developers/official-public-nodes/">Official Public Nodes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/deployment/">Deployment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/run-in-idea/">Run FullNode in IDEA</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/contribution/">Contribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/incentives/">Incentive Policy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/java-tron/">Java-Tron</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/tips/">TIPs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/advanced-configuration/">Advanced Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Clients</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../clients/wallet-cli/">Wallet-cli</a>
                </li>
                <li class="">
                    
    <a class="" href="../../clients/tron-grid/">TronGrid</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Releases</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../releases/">Binary Integrity Check</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../glossary/">Glossary</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">TRON Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Architecture &raquo;</li>
        
      
    
    <li>Database</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/tronprotocol/documentation-en/edit/master/docs/architecture/database.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="the-database">The Database<a class="headerlink" href="#the-database" title="Permanent link">&para;</a></h1>
<h2 id="use-rocksdb">Use RocksDB<a class="headerlink" href="#use-rocksdb" title="Permanent link">&para;</a></h2>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h3>
<p>Use RocksDB as the data storage engine, need to set <code>db.engine</code> to "ROCKSDB".</p>
<p><img alt="image" src="https://raw.githubusercontent.com/tronprotocol/documentation-en/master/images/db_engine.png" /></p>
<p>Note: RocksDB only supports <code>db.version=2</code>, yet does not supports <code>db.version=1</code></p>
<p>The optimization parameters RocksDB support:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/tronprotocol/documentation-en/master/images/rocksdb_tuning_parameters.png" /></p>
<h3 id="use-rocksdbs-data-backup-function">Use RocksDB's data backup function<a class="headerlink" href="#use-rocksdbs-data-backup-function" title="Permanent link">&para;</a></h3>
<p>Choose RocksDB to be the data storage engine, you can use its data backup function while running</p>
<p><img alt="image" src="https://raw.githubusercontent.com/tronprotocol/documentation-en/master/images/db_backup.png" /></p>
<p>Note: FullNode can use data backup function. In order not to affect SuperNode's block producing performance, SuperNode does not support backup service, but SuperNode's backup service node can use this function.</p>
<h3 id="convert-leveldb-data-to-rocksdb-data">Convert LevelDB data to RocksDB data<a class="headerlink" href="#convert-leveldb-data-to-rocksdb-data" title="Permanent link">&para;</a></h3>
<p>The data storage structure of LevelDB and RocksDB is not compatible, please make sure the node use the same type of data engine all the time. We provide data conversion script which can convert LevelDB data to RocksDB data.</p>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;</span> <span class="nb">cd</span> /path/to/java-tron/source-code
<span class="gp">&gt;</span> ./gradlew build  <span class="c1"># build the source code</span>
<span class="gp">&gt;</span> java -jar build/libs/DBConvert.jar  <span class="c1"># run data conversion command</span>
</code></pre></div>

<p>Note: If the node's data storage directory is self-defined, before run DBConvert.jar, you need to add the following parameters:</p>
<ul>
<li><strong>src_db_path</strong>: specify LevelDB source directory, default output-directory/database</li>
<li><strong>dst_db_path</strong>: specify RocksDb source directory, default output-directory-dst/database</li>
</ul>
<p>Example, if you run the script like this:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;</span> nohup java -jar FullNode.jar -d your_database_dir &lt;/dev/null <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
</code></pre></div>

<p>then, you should run DBConvert.jar this way:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;</span> java -jar build/libs/DBConvert.jar your_database_dir/database output-directory-dst/database
</code></pre></div>

<p>Note: You have to stop the running of the node, and then to run the data conversion script.</p>
<p>If you do not want to stop the running of the node for too long, after node is shut down, you can copy leveldb's output-directory to the new directory, and then restart the node. Run DBConvert.jar in the previous directory of the new directory, and specify the parameters: <code>src_db_path</code> and <code>dst_db_path</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;</span> cp -rf output-directory /tmp/output-directory
<span class="gp">&gt;</span> <span class="nb">cd</span> /tmp
<span class="gp">&gt;</span> java -jar DBConvert.jar output-directory/database output-directory-dst/database
</code></pre></div>

<p>All the whole data conversion process may take 10 hours.</p>
<h3 id="rocksdb-vs-leveldb">RocksDB vs LevelDB<a class="headerlink" href="#rocksdb-vs-leveldb" title="Permanent link">&para;</a></h3>
<p>You can refer to:</p>
<ul>
<li><a href="https://github.com/tronprotocol/documentation/blob/master/TRX/Rocksdb_vs_Leveldb.md">RocksDB vs LevelDB(en)</a></li>
<li><a href="https://github.com/tronprotocol/documentation/blob/master/TRX_CN/Rocksdb_vs_Leveldb.md">RocksDB vs LevelDB(zh-cn)</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../event/" class="btn btn-neutral float-right" title="Event Subsystem">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../network/" class="btn btn-neutral" title="Network"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/tronprotocol/documentation-en/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../network/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../event/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
