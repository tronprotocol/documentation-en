<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Leveldb Startup Optimization Plugins - Java Tron</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Leveldb Startup Optimization Plugins";
    var mkdocs_page_input_path = "developers/archive-manifest.md";
    var mkdocs_page_url = "/documentation-en/developers/archive-manifest/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Java Tron</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Getting Started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/">Repository</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/dpos/">DPoS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/overview/">Overview</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/http/">HTTP API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/rpc/">RPC API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanism & Algorithm</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/sr/">SR and Committee</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/trc10/">TRC-10</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/account/">Account Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/resource/">Resource Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/dex/">Decentralized Exchange</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/multi-signatures/">Multi-Signature</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/shielded-TRC20-contract/">Shielded TRC20 Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/system-contracts/">System Contracts</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../architecture/network/">Network</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/database/">Database</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/event/">Event Subsystem</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Smart Contract</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contracts/tvm/">TVM</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/compiler/">Compiler</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/contract/">Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/trc20/">TRC-20</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../official-public-nodes/">Official Public Nodes</a>
                </li>
                <li class="">
                    
    <a class="" href="../deployment/">Deployment</a>
                </li>
                <li class="">
                    
    <a class="" href="../run-in-idea/">Run FullNode in IDEA</a>
                </li>
                <li class="">
                    
    <a class="" href="../litefullnode/">Run Lite FullNode</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Leveldb Startup Optimization Plugins</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#leveldb-startup-optimization-plugins">Leveldb Startup Optimization Plugins</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#introduction">Introduction</a></li>
        
            <li><a class="toctree-l4" href="#usage">Usage</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../contribution/">Contribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../incentives/">Incentive Policy</a>
                </li>
                <li class="">
                    
    <a class="" href="../java-tron/">Java-Tron</a>
                </li>
                <li class="">
                    
    <a class="" href="../tips/">TIPs</a>
                </li>
                <li class="">
                    
    <a class="" href="../advanced-configuration/">Advanced Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../gpg/">Contact Us (GPG Key)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Clients</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../clients/wallet-cli/">Wallet-cli</a>
                </li>
                <li class="">
                    
    <a class="" href="../../clients/tron-grid/">TronGrid</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Releases</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../releases/">Binary Integrity Check</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../glossary/">Glossary</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Java Tron</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developers &raquo;</li>
        
      
    
    <li>Leveldb Startup Optimization Plugins</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/tronprotocol/documentation-en/edit/master/docs/developers/archive-manifest.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="leveldb-startup-optimization-plugins">Leveldb Startup Optimization Plugins<a class="headerlink" href="#leveldb-startup-optimization-plugins" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>With the operation of levelDB, manifest file will continue to grow, huge manifest file not only affects the node startup speed, but also may cause the problem of system exit with continuous memory growth.
For this reason, leveldb startup optimization plugin is introduced since <code>GreatVoyage-v4.3.0(Bacon)</code>, which optimizes the file size of manifest and the startup process of LevelDB, reduces the memory occupation and improves the node startup speed.</p>
<p>Remember stop the FullNode process before any operation. This tool provides the ability to reformat the manifest according to the current <code>database</code>.</p>
<p>For more design details, please refer to: <a href="https://github.com/tronprotocol/tips/issues/298">TIP298</a>.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<h3 id="options-for-plug-in">Options For Plug-in<a class="headerlink" href="#options-for-plug-in" title="Permanent link">&para;</a></h3>
<ul>
<li><code>-b | --batch-size</code>: [ int ]  specify the batch manifest size,default：80000.</li>
<li><code>-d | --database-directory</code>: [ string ]  Specify the database directory to be processed,default：output-directory/database.</li>
<li><code>-m | --manifest-size</code>: [ int ] Specify the minimum required manifest file size ，unit:M，default：0.</li>
<li><code>-h | --help</code>: [ bool ]  for usage help，default：false.</li>
</ul>
<h3 id="how-to-get">How to get<a class="headerlink" href="#how-to-get" title="Permanent link">&para;</a></h3>
<ul>
<li>build by yourself.
  Under java-tron, execute <code>. /gradlew build</code>, you can get ArchiveManifest.jar under <code>build/libs/</code>.</li>
<li>Download directly.
  <a href="https://github.com/tronprotocol/java-tron/releases">Links</a></li>
</ul>
<h3 id="use-steps">Use Steps<a class="headerlink" href="#use-steps" title="Permanent link">&para;</a></h3>
<ul>
<li>
<ol>
<li>Stop the FullNode service.</li>
</ol>
</li>
<li>
<ol>
<li>Execute the ArchiveManifest plugin.</li>
</ol>
</li>
<li>
<ol>
<li>Start the FullNode service.</li>
</ol>
</li>
</ul>
<blockquote>
<p>Note: <code>Step ii</code> is not required every time, but it is recommended to run it every time to optimize the experience.</p>
</blockquote>
<h3 id="how-to-use">How to use<a class="headerlink" href="#how-to-use" title="Permanent link">&para;</a></h3>
<p>After FullNode runs, the default database directory: <code>output-directory</code>, the optimization plugin will work with the <code>output-directory/database</code> directory.
Developers can choose one of the following two ways  according to actual situation.</p>
<h4 id="1-use-it-independently">1. Use it Independently<a class="headerlink" href="#1-use-it-independently" title="Permanent link">&para;</a></h4>
<h5 id="1stop-the-fullnode-service">1.Stop the FullNode service<a class="headerlink" href="#1stop-the-fullnode-service" title="Permanent link">&para;</a></h5>
<p>Use <code>kill -15</code> to shutdown the FullNode.jar .</p>
<p>Query the pid: <code>ps -ef |grep FullNode.jar |grep -v grep |awk '{print $2}'</code></p>
<h5 id="2execute-the-archivemanifest-plugin">2.Execute the ArchiveManifest plugin<a class="headerlink" href="#2execute-the-archivemanifest-plugin" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1"># Full command</span>
java -jar ArchiveManifest.jar <span class="o">[</span>-b batchSize<span class="o">]</span> <span class="o">[</span>-d databaseDirectory<span class="o">]</span> <span class="o">[</span>-m manifestSize<span class="o">]</span> <span class="o">[</span>-h<span class="o">]</span>
<span class="c1"># examples</span>
   java -jar ArchiveManifest.jar <span class="c1">#1. use default settings</span>
   java -jar ArchiveManifest.jar -d /tmp/db/database <span class="c1">#2. Specify the database directory as /tmp/db/database</span>
   java -jar ArchiveManifest.jar -b <span class="m">64000</span> <span class="c1">#3. Specify the batch size to 64000 when optimizing Manifest</span>
   java -jar ArchiveManifest.jar -m <span class="m">128</span> <span class="c1">#4. Specify optimization only when Manifest exceeds 128M</span>
</code></pre></div>
<p>After the command is executed, <code>archive.log</code> will be generated in the <code>./logs</code> directory, you can see the result.</p>
<blockquote>
<p>Note: After the command is executed，If successful, the log will display something similar to the following,
and will run generally within 120s, depending on how long the FullNode service keeps running,
and if it fails there will be a corresponding error message</p>
<p><code>[main] [archive](ArchiveManifest.java:144) DatabaseDirectory:output-directory/database, maxManifestSize:0, maxBatchSize:80000,database reopen use 80 seconds total.</code></p>
</blockquote>
<h5 id="3start-the-fullnode-service">3.Start the FullNode service<a class="headerlink" href="#3start-the-fullnode-service" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code> <span class="c1">#FullNode</span>
nohup java -Xmx24g -XX:+UseConcMarkSweepGC -jar FullNode.jar -c main_net_config.conf &lt;/dev/null <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
 <span class="c1">#SR Node</span>
nohup java -Xmx24g -XX:+UseConcMarkSweepGC  -jar FullNode.jar  -p  private key --witness -c main_net_config.conf &lt;/dev/null <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
</code></pre></div>
<h4 id="2-integrated-startup-script">2. Integrated startup script<a class="headerlink" href="#2-integrated-startup-script" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">APP</span><span class="o">=</span><span class="nv">$1</span>

<span class="nv">MANIFEST_OPT</span><span class="o">=</span><span class="nv">$2</span>

<span class="nv">ALL_OPT</span><span class="o">=</span><span class="nv">$*</span>

<span class="nv">NEED_REBUILD</span><span class="o">=</span><span class="m">0</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s1">&#39;--rewrite--manifest&#39;</span> <span class="o">]]</span>  <span class="p">;</span> <span class="k">then</span>
   <span class="nv">APP</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
   <span class="nv">NEED_REBUILD</span><span class="o">=</span><span class="m">1</span>

 <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$2</span> <span class="o">==</span> <span class="s1">&#39;--rewrite--manifest&#39;</span> <span class="o">]]</span>  <span class="p">;</span> <span class="k">then</span>
   <span class="nv">NEED_REBUILD</span><span class="o">=</span><span class="m">1</span>
 <span class="k">fi</span>


rebuildManifest<span class="o">()</span> <span class="o">{</span>

 <span class="k">if</span> <span class="o">[[</span> <span class="nv">$NEED_REBUILD</span> <span class="o">==</span> <span class="m">1</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
   buildManifest
 <span class="k">fi</span>

<span class="o">}</span>


buildManifest<span class="o">()</span> <span class="o">{</span>

 <span class="nv">ARCHIVE_JAR</span><span class="o">=</span><span class="s1">&#39;ArchiveManifest.jar&#39;</span>

 java -jar <span class="nv">$ARCHIVE_JAR</span> <span class="nv">$ALL_OPT</span>

 <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>

     <span class="nb">echo</span> <span class="s1">&#39;rebuild manifest success&#39;</span>

 <span class="k">else</span>

     <span class="nb">echo</span> <span class="s1">&#39;rebuild manifest fail, log in logs/archive.log&#39;</span>

 <span class="k">fi</span>

<span class="o">}</span>



<span class="nv">APP</span><span class="o">=</span><span class="si">${</span><span class="nv">APP</span><span class="k">:-</span><span class="s2">&quot;FullNode&quot;</span><span class="si">}</span>

<span class="nv">START_OPT</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="si">${</span><span class="p">@:</span><span class="nv">2</span><span class="si">}</span><span class="sb">`</span>

<span class="nv">JAR_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$APP</span><span class="s2">.jar&quot;</span>

<span class="nv">MAX_STOP_TIME</span><span class="o">=</span><span class="m">60</span>

<span class="nv">MEM_OPT</span><span class="o">=</span><span class="s1">&#39;&#39;</span>





checkpid<span class="o">()</span> <span class="o">{</span>

 <span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>ps -ef <span class="p">|</span> grep <span class="nv">$JAR_NAME</span> <span class="p">|</span>grep -v grep <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>

 <span class="k">return</span> <span class="nv">$pid</span>

<span class="o">}</span>

checkPath<span class="o">(){</span>
  <span class="nv">path</span><span class="o">=</span><span class="s1">&#39;output-directory/database&#39;</span>
  <span class="nv">flag</span><span class="o">=</span><span class="m">1</span>
  <span class="k">for</span> p <span class="k">in</span> <span class="si">${</span><span class="nv">ALL_OPT</span><span class="si">}</span>
  <span class="k">do</span>
     <span class="k">if</span> <span class="o">[[</span> <span class="nv">$flag</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nv">path</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$p</span><span class="sb">`</span>
        <span class="nb">break</span>
     <span class="k">fi</span>
     <span class="k">if</span> <span class="o">[[</span> <span class="nv">$p</span> <span class="o">==</span> <span class="s1">&#39;-d&#39;</span> <span class="o">||</span> <span class="nv">$p</span> <span class="o">==</span> <span class="s1">&#39;--database-directory&#39;</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nv">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="nv">flag</span><span class="o">=</span><span class="m">0</span>
     <span class="k">fi</span>
  <span class="k">done</span>

  <span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="si">${</span><span class="nv">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
     <span class="nb">echo</span> <span class="s1">&#39;-d /path or --database-directory /path&#39;</span>
     <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>

  <span class="k">if</span> <span class="o">[[</span> -d <span class="si">${</span><span class="nv">path</span><span class="si">}</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="nv">$path</span> <span class="s1">&#39;not exist&#39;</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>



stopService<span class="o">()</span> <span class="o">{</span>

  <span class="nv">count</span><span class="o">=</span><span class="m">1</span>

  <span class="k">while</span> <span class="o">[</span> <span class="nv">$count</span> -le <span class="nv">$MAX_STOP_TIME</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>

    checkpid

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$pid</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>

       <span class="nb">kill</span> -15 <span class="nv">$pid</span>

       sleep <span class="m">1</span>

    <span class="k">else</span>

       <span class="nb">echo</span> <span class="s2">&quot;java-tron stop&quot;</span>

       <span class="k">return</span>

    <span class="k">fi</span>

    <span class="nv">count</span><span class="o">=</span>$<span class="o">[</span><span class="nv">$count</span>+1<span class="o">]</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$count</span> -eq <span class="nv">$MAX_STOP_TIME</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>

      <span class="nb">kill</span> -9 <span class="nv">$pid</span>

      sleep <span class="m">1</span>

    <span class="k">fi</span>

  <span class="k">done</span>

<span class="o">}</span>

startService<span class="o">()</span> <span class="o">{</span>
 <span class="nb">echo</span> <span class="sb">`</span>date<span class="sb">`</span> &gt;&gt; start.log

 <span class="nv">total</span><span class="o">=</span><span class="m">16</span>*1024*1024

 <span class="nv">xmx</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$total</span><span class="s2">/1024/1024*0.6&quot;</span> <span class="p">|</span> bc <span class="p">|</span>awk -F. <span class="s1">&#39;{print $1&quot;g&quot;}&#39;</span><span class="sb">`</span>

 <span class="nv">directmem</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$total</span><span class="s2">/1024/1024*0.1&quot;</span> <span class="p">|</span> bc <span class="p">|</span>awk -F. <span class="s1">&#39;{print $1&quot;g&quot;}&#39;</span><span class="sb">`</span>

 <span class="nv">logtime</span><span class="o">=</span><span class="sb">`</span>date +%Y-%m-%d_%H-%M-%S<span class="sb">`</span>

 <span class="nb">export</span> <span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="s2">&quot;/usr/lib64/libtcmalloc.so&quot;</span>

  nohup java -Xms<span class="nv">$xmx</span> -Xmx<span class="nv">$xmx</span> -XX:+UseConcMarkSweepGC -XX:+PrintGCDetails -Xloggc:./gc.log<span class="se">\</span>
  -XX:+PrintGCDateStamps -XX:+CMSParallelRemarkEnabled -XX:ReservedCodeCacheSize<span class="o">=</span>256m -XX:+UseCodeCacheFlushing<span class="se">\</span>
  <span class="nv">$MEM_OPT</span> -XX:MaxDirectMemorySize<span class="o">=</span><span class="nv">$directmem</span> -XX:+HeapDumpOnOutOfMemoryError -jar <span class="nv">$JAR_NAME</span> <span class="nv">$START_OPT</span> -c config.conf  &gt;&gt; start.log <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>

 <span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>ps -ef <span class="p">|</span>grep <span class="nv">$JAR_NAME</span> <span class="p">|</span>grep -v grep <span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>

 <span class="nb">echo</span> <span class="s2">&quot;start java-tron with pid </span><span class="nv">$pid</span><span class="s2"> on </span><span class="nv">$HOSTNAME</span><span class="s2">&quot;</span>

<span class="o">}</span>

<span class="c1">#1.Stop the FullNode service</span>
stopService

checkPath

<span class="c1">#2.Execute the ArchiveManifest plugin</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">0</span> <span class="o">==</span>  <span class="nv">$?</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
 rebuildManifest
<span class="k">else</span>
 <span class="nb">exit</span> -1
<span class="k">fi</span>

sleep <span class="m">5</span>
<span class="c1"># Start the FullNode service</span>
startService
</code></pre></div>
 example</p>
<blockquote>
<p>Note: Save above script as start.sh,  In the above script the <code>--rewrite--manifest</code> argument is fixed in the first or second argument.</p>
<p>OPTIONS</p>
<div class="codehilite"><pre><span></span><code>       --rewrite--manifest       enable leveldb startup optimization plugins，The above plug-in option `-d -m -b -h` will take effect iff this option(--rewrite--manifest) is turned on
</code></pre></div>

</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Full command</span>
./start.sh <span class="o">[</span>FullNode<span class="p">|</span>SolidityNode<span class="o">]</span> <span class="o">[</span>--rewrite--manifest<span class="o">]</span> <span class="o">[</span>-b batchSize<span class="o">]</span> <span class="o">[</span>-d databaseDirectory<span class="o">]</span> <span class="o">[</span>-m manifestSize<span class="o">]</span>
<span class="c1"># examples</span>
  ./start.sh <span class="c1">#1. Start the FullNode.jar service without the plugin</span>
   ./start.sh SolidityNode <span class="c1">#2. Start the SolidityNode.jar service without the plugin</span>
   ./start.sh FullNode --rewrite--manifest <span class="c1">#3. Execute the optimization plugin with default settings and start the FullNode.jar service</span>
   ./start.sh --rewrite--manifest -d /tmp/db/database <span class="c1">#4. Specify the database directory as /tmp/db/database, execute the optimization plugin, and start the FullNode.jar service</span>
   ./start.sh --rewrite--manifest -b <span class="m">64000</span> <span class="c1">#5. Specify the batch size to 64000 when optimizing Manifest, and start the FullNode.jar service</span>
   ./start.sh --rewrite--manifest -m <span class="m">128</span> <span class="c1">#6. Specify that optimization is performed only when the Manifest exceeds 128M, and start the FullNode.jar service</span>
</code></pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../resources/" class="btn btn-neutral float-right" title="Resources">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../litefullnode/" class="btn btn-neutral" title="Run Lite FullNode"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/tronprotocol/documentation-en/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../litefullnode/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../resources/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
