<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tronprotocol.github.io/documentation-en/releases/upgrade-instruction/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Deployment Manual for the New Version - Java Tron</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Deployment Manual for the New Version";
        var mkdocs_page_input_path = "releases/upgrade-instruction.md";
        var mkdocs_page_url = "/documentation-en/releases/upgrade-instruction/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Java Tron
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started_with_javatron/">Getting Started with Java-tron</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using Java-tron</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/installing_javatron/">Deploying Java-tron</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/backup_restore/">Backup & Restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/litefullnode/">Lite FullNode</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/private_network/">Private Network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/event/">Event Subscription</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/database/">Database Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/connecting_to_tron/">Network Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/metrics/">Node Monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/toolkit/">Node Maintenance Tool</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/http/">HTTP API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/rpc/">gRPC API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Core Protocol</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../introduction/dpos/">DPoS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/sr/">Super Representative</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/account/">Account Model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/resource/">Resource Model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/contract/">Smart Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/system-contracts/">System Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/dex/">Decentralized Exchange</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mechanism-algorithm/multi-signatures/">Multi-Signature</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For Java-tron Developers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/java-tron/">Developer Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/tips/">TIPs Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/issue-workflow/">Issue Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/governance/">Governance Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/run-in-idea/">Configure the IDE</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/demo/">Development Example</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/code-structure/">Core Modules</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For DAPP developers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/compiler/">Dapp Development Tool</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Wallet-cli</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli/">What is Wallet-CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli-command/">Wallet Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Releases</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Deployment Manual for the New Version</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#new-version-deployment-process">New version deployment Process</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-prepare-the-executable-file-of-the-new-version">1. Prepare the executable file of the new version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-shut-down-the-java-tron-process">2. Shut down the Java-tron process</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-backup">3. Backup</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4-replace-old-version-files">4. Replace old version files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#5-start-the-nodes">5. Start the nodes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#6-wait-for-syncing-completion">6. Wait for syncing completion</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#7-upgrade-completed">7. Upgrade completed</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#active-and-backup-nodes-upgrade-guide">Active and Backup Nodes Upgrade Guide</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../signature_verification/">Integrity Check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../history/">History</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Java Tron</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Releases &raquo;</li><li>Deployment Manual for the New Version</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/tronprotocol/documentation-en/edit/master/docs/releases/upgrade-instruction.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="new-version-deployment-manual-of-java-tron">New Version Deployment Manual of Java-tron<a class="headerlink" href="#new-version-deployment-manual-of-java-tron" title="Permanent link">&para;</a></h1>
<p>For the mandatory upgrade versions, please strictly follow this guide to deploy the new version. For the non-mandatory upgrade ones, you can decide whether to deploy it according to your needs. </p>
<p>Please directly refer to <a href="#new-version-deployment-process">Java-tron New version deployment Process</a> to upgrade your node. If you have deployed 'Active and Backup nodes', please follow the process of <a href="#active-and-backup-nodes-upgrade-guide">Active and Backup Nodes Upgrade Guide</a>. </p>
<h2 id="new-version-deployment-process">New version deployment Process<a class="headerlink" href="#new-version-deployment-process" title="Permanent link">&para;</a></h2>
<p>Please follow the below steps to upgrade your FullNode, FullNode that produces blocks to the latest version.</p>
<h3 id="1-prepare-the-executable-file-of-the-new-version">1. Prepare the executable file of the new version<a class="headerlink" href="#1-prepare-the-executable-file-of-the-new-version" title="Permanent link">&para;</a></h3>
<p>You can directly download the Java-tron executable file, or download the code of the latest version and compile it to get the executable file of the new version. Please download the latest version of the code or jar file to a file directory other than the Java-tron running directory:</p>
<ul>
<li>
<p>Way 1: Download the published executable file</p>
<p>Directly download the latest version of the executable file FullNode.jar from the release page <a href="https://github.com/tronprotocol/java-tron/releases">https://github.com/tronprotocol/java-tron/releases</a>.</p>
<p>Before using it, please verify the file signature first to ensure the consistency and integrity of the jar file. For the verification steps, please refer to <a href="https://tronprotocol.github.io/documentation-en/releases/signature_verification/">Java-tron Consistency Verification</a>.</p>
</li>
<li>
<p>Way 2: Compile the source code</p>
<p>Download the source code and switch to the branch of the new version.
<div class="highlight"><pre><span></span><code>$ git clone https://github.com/tronprotocol/java-tron.git
$ git checkout -b relase_vx.x.x
</code></pre></div></p>
<p>Compile the project: In the code directory of the new version, execute the following command to compile the project, and the compiled executable file will be generated in the <code>build/libs</code> directory.
<div class="highlight"><pre><span></span><code>$ ./gradlew clean build -x test
</code></pre></div></p>
</li>
</ul>
<h3 id="2-shut-down-the-java-tron-process">2. Shut down the Java-tron process<a class="headerlink" href="#2-shut-down-the-java-tron-process" title="Permanent link">&para;</a></h3>
<p>Shut down the node process. Note: If a Java-tron node has not been deployed on this machine before, please skip to step 5.</p>
<ul>
<li>
<p>First, get the process ID of the Java-tron node through the following command
    <div class="highlight"><pre><span></span><code>$ ps -ef | grep java
</code></pre></div></p>
</li>
<li>
<p>Shut down the node process
    <div class="highlight"><pre><span></span><code>$ kill -15 the process id
</code></pre></div></p>
</li>
</ul>
<h3 id="3-backup">3. Backup<a class="headerlink" href="#3-backup" title="Permanent link">&para;</a></h3>
<p>Please back up the executable file, database, and configuration file before the upgrade in sequence. The backup data is used to restore to the old version when a problem is encountered that leads to fail deploying during the upgrade.</p>
<ul>
<li>Backup the current executable jar file
    <div class="highlight"><pre><span></span><code>$ mv $JAVA_TRON.jar $JAVA_TRON.jar.`date &quot;+%Y%m%d%H%M%S&quot;`
</code></pre></div></li>
<li>Backup the current database <code>output-directory</code>
    <div class="highlight"><pre><span></span><code>$ tar cvzf output-directory.`date &quot;+%Y%m%d%H%M%S&quot;`.etgz output-directory
</code></pre></div></li>
<li>Backup the current configuration file
    <div class="highlight"><pre><span></span><code>$ mv $config.conf $config.conf.`date &quot;+%Y%m%d%H%M%S&quot;`
</code></pre></div></li>
</ul>
<h3 id="4-replace-old-version-files">4. Replace old version files<a class="headerlink" href="#4-replace-old-version-files" title="Permanent link">&para;</a></h3>
<p>After preparing the executable file of the new version and backing up the original node data, please follow the steps below to replace the old files:</p>
<ol>
<li>Copy the newest jar package obtained in the previous step to the Java-tron working directory to replace the old executable file.</li>
<li>Replace the old configuration file with the latest configuration file. If you need to modify the configuration, such as adding a keystore file, private key, etc, please modify it yourself.</li>
</ol>
<p>Note: For the database file, you can use the original database file in the Java-tron working directory, or you can choose to use <a href="https://tronprotocol.github.io/documentation-en/using_javatron/backup_restore/#public-backup-data">database backup snapshot</a>.</p>
<h3 id="5-start-the-nodes">5. Start the nodes<a class="headerlink" href="#5-start-the-nodes" title="Permanent link">&para;</a></h3>
<p>The startup commands of FullNode which produces blocks and ordinary FullNode are different, please choose the startup command according to the actual situation:</p>
<ul>
<li>
<p>For the super representative's FullNode, the startup command is:
    <div class="highlight"><pre><span></span><code>nohup java -Xmx24g -XX:+UseConcMarkSweepGC  -jar FullNode.jar  -p  private key --witness -c main_net_config.conf &lt;/dev/null &amp;&gt;/dev/null &amp;
</code></pre></div>
    Note: It is not necessary to use the above command parameter to set the private key. If you use the keystore file or configure the private key in the configuration file, please set it up your way.</p>
</li>
<li>
<p>For a FullNode, the startup command is:
    <div class="highlight"><pre><span></span><code>nohup java -Xmx24g -XX:+UseConcMarkSweepGC -jar FullNode.jar -c   main_net_config.conf &lt;/dev/null &amp;&gt;/dev/null &amp;
</code></pre></div></p>
</li>
</ul>
<h3 id="6-wait-for-syncing-completion">6. Wait for syncing completion<a class="headerlink" href="#6-wait-for-syncing-completion" title="Permanent link">&para;</a></h3>
<p>After the node is successfully started, please wait patiently for the node block synchronization to complete.</p>
<h3 id="7-upgrade-completed">7. Upgrade completed<a class="headerlink" href="#7-upgrade-completed" title="Permanent link">&para;</a></h3>
<p>After the node is synchronized to the latest block of the network, it means that the deployment of the new version is completed.</p>
<p>If you encounter any problems during the upgrade leading to fail deploying the new version, please use the data backed up in the third step to restore to the old version, and give your feedback in GitHub or the community in time to help you complete the deployment of the new version as soon as possible.</p>
<h2 id="active-and-backup-nodes-upgrade-guide">Active and Backup Nodes Upgrade Guide<a class="headerlink" href="#active-and-backup-nodes-upgrade-guide" title="Permanent link">&para;</a></h2>
<p>To upgrade the active and backup nodes, please follow the steps below:</p>
<ol>
<li>
<p>Upgrade the backup node</p>
<p>Upgrade the backup node according to the <a href="#new-version-deployment-process">Java-tron new version deployment Process</a>.</p>
</li>
<li>
<p>Shut down the master node</p>
<p>After the backup node is successfully upgraded to the new version, please wait for the completion of synchronization of the backup node before shutting down the master node. At this time, the backup node will automatically take over from the master node and become the active node.</p>
</li>
<li>
<p>Upgrade the master node</p>
<p>If the backup node works normally, follow <a href="#new-version-deployment-process">Java-tron New Version Deployment Process</a> to upgrade the master node. Otherwise, shut down the backup node and start the master node. If an error occurs during the upgrade, please contact TRON technical support team and send the nodeâ€™s log for root cause analysis.</p>
</li>
<li>
<p>Shut down the backup node</p>
<p>After the master node is upgraded and fully synchronized, shut down the backup node. After the backup node shuts down, the master node will take over as the active node again.</p>
</li>
<li>
<p>Start the backup node</p>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../clients/wallet-cli-command/" class="btn btn-neutral float-left" title="Wallet Commands"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../signature_verification/" class="btn btn-neutral float-right" title="Integrity Check">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tronprotocol/documentation-en" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../clients/wallet-cli-command/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../signature_verification/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
